!function(){function a(){}var b=Array.prototype.slice;Function.prototype.bind||(Function.prototype.bind=function(c){var d,e,f=this;if("function"!=typeof f)throw new TypeError("Function.prototype.bind called on incompatible "+f);return e=b.call(arguments,1),d=function(){if(this instanceof d){var a=f.apply(this,e.concat(b.call(arguments)));return Object(a)===a?a:this}return f.apply(c,e.concat(b.call(arguments)))},f.prototype&&(a.prototype=f.prototype,d.prototype=new a,a.prototype=null),d})}(),"undefined"==typeof Date.now&&(Date.now=function(){return(new Date).valueOf()}),function(a){function b(a){return!!a&&"function"==typeof a||/Function|Constructor/.test(Object.prototype.toString.call(a))}function c(a,b,c,d){this.string=a,this.test=new RegExp(b),this.identity=c,this.versionSearch=d}function d(a,b,c){return parseFloat(b.substring(a+c.length+1))}function e(a){return a.test.test(a.string)}function f(){var a=h.versionSearch||h.identity,b=k.indexOf(a),c=m.indexOf(a);return b>-1&&d(b,k,a)||c>-1&&d(c,m,a)||-1}function g(a){return i.audioElement&&!!this.canPlayType(a.test).replace(/^no$/,"")&&a}var h,i=a.__DMAF={},j=navigator.platform,k=navigator.userAgent,l=navigator.vendor,m=navigator.appVersion,n=[new c(k,"CriOS","Chrome iOS","CriOS"),new c(k,"iPhone|iPad|iPod","Mobile Safari","Version"),new c(k,"Chrome","Chrome"),new c(l,"Apple","Safari","Version"),new c(window.opera,"Opera","Opera","Version"),new c(k,"Firefox","Firefox"),new c(k,"MSIE","Explorer","MSIE")],o=[new c(j,"iPhone|iPad|iPod","iOS"),new c(k,"Android","Android"),new c(j,"Win","Windows"),new c(j,"Mac","Mac"),new c(j,"Linux","Linux")],p=document.createElement("audio"),q=document.createElement("video"),r={audio:[{ext:".ogg",test:'audio/ogg; codecs="vorbis"'},{ext:".aac",test:'audio/mp4; codecs="mp4a.40.2"'},{ext:".mp4",test:"audio/mp4;"}],video:[{ext:".mp4",test:"video/mp4;"},{ext:".webm",test:"video/webm;"}]};i.web=!("undefined"==typeof window||!a.navigator||!a.document),i.xhr=i.web&&b(window.XMLHttpRequest),i.xhr2=i.web&&i.xhr&&"responseType"in new XMLHttpRequest,i.xdr=i.web&&"XDomainRequest"in window,i.arraybuffer=i.web&&b(window.ArrayBuffer)&&b((new ArrayBuffer).slice),i.webaudio=i.web&&(b(window.webkitAudioContext)||b(window.AudioContext)),i.touch=i.web&&"createTouch"in document,i.audioElement=i.web&&!!document.createElement("audio").canPlayType,i.webSockets=i.web&&"undefined"!=typeof WebSocket,i.now=i.web&&!("undefined"==typeof window.performance||!window.performance.now),i.ok=i.xhr&&i.audioElement&&b(Object.create),h=n.filter(e).shift(),i.browser=h&&h.identity,i.browserVersion=h&&(f(k)||f(m)||-1),h=h&&o.filter(e).shift(),i.OS=h&&h.identity,h=r.audio.filter(g,p).shift(),i.audioFormat=h&&h.ext,i.audioType=h&&h.test,h=r.video.filter(g,q).shift(),i.videoFormat=h&&h.ext,i.videoType=h&&h.test,!i.browser&&/Trident/.test(k)&&(i.browser="Explorer",i.browserVersion=11),"Explorer"===i.browser&&(i.audioFormat=".mp4",i.audioType="audio/mp4"),"Safari"!==i.browser||i.webaudio||(i.audioFormat=".mp4",i.audioType="audio/mp4"),i.web&&(window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){return setTimeout(a,1e3/60)},window.cancelAnimationFrame||(window.cancelAnimationFrame=clearTimeout))}(this),function(){function a(a,b,c){var d=typeof c;"string"==typeof a&&b&&"undefined"!==d?"function"===d?(h[a]=c,c.deps=b,c.name=a):i[a]=c:i[a]={}}function b(a){return i[a]||c(a)}function c(a){return i[a]=h[a]?h[a].apply(null,h[a].deps.map(b))||{}:{}}function d(b){b(g),delete a._init}function e(){return""}function f(){return a}var g={require:b},h=g.modules={},i=g.seen={};a.version="0.0.15",a.toString=e,a._init=d,"undefined"==typeof window?"undefined"!=typeof global&&(global.dmaf=a):window.dmaf=a,"undefined"!=typeof module&&module.exports?module.exports=a:"function"==typeof define&&define(f),"undefined"!=typeof __DMAF&&(a("info",[],__DMAF),delete this.__DMAF),a("core",[],g)}(),dmaf("events",[],function(){function a(a){if(!a||"string"!=typeof a)return null;var b,c=i,e=d(a),f=[];i=0;for(var g=0,h=e.length;h>g&&(b=e[g],m=g,f.push(b.apply(null,arguments)),!i);g++);return m=-1,i=c,f.length?f:null}function b(){return m}function c(a,b){var c,e=i,f=d(b),g=[];i=0;for(var h=a,j=f.length;j>h&&(c=f[h],g.push(c.apply(null,[].slice.apply(arguments,1))),!i);h++);return i=e,g.length?g:null}function d(a){for(var b,c=a.split(l),d=k,e=[],f=0,g=c.length;g>f&&(b=d.names&&d.names[c[f]],b);f++)e=e.concat(b.listeners||[]),d=d.names[c[f]];return e}function e(){i=1}function f(a,b){for(var c=a.split(l),d=k,e=0,f=c.length;f>e;e++)d=d.names,d[j](c[e])&&void 0!==d[c[e]]?d=d[c[e]]:(d[c[e]]={names:{}},d=d[c[e]]);for(d.listeners=d.listeners||[],e=0,f=d.listeners.length;f>e;e++)if(d.listeners[e]===b)return b;return d.listeners.push(b),b}function g(a,b){var c=function(){return h(a,c),b.apply(this,arguments)};return f(a,c)}function h(a,b){var c,d,e,f,g,h,i,m=a.split(l),n=[k];for(f=0,g=m.length;g>f;f++)for(h=0;h<n.length;h++)e=[h,1],c=n[h].names,c[m[f]]&&e.push(c[m[f]]),n.splice.apply(n,e);for(f=0,g=n.length;g>f;f++)for(c=n[f];c.names;){if(b){if(c.listeners){for(h=0,i=c.listeners.length;i>h;h++)if(c.listeners[h]===b){c.listeners.splice(h,1);break}c.listeners.length||delete c.listeners}for(d in c.names)if(c.names[j](d)&&c.names[d].listeners){var o=c.names[d].listeners;for(h=0,i=o.length;i>h;h++){if(o[h]===b){o.splice(h,1);break}o.length||delete c.names[d].listeners}}}else{delete c.listeners;for(d in c.names)c.names[j](d)&&c.names[d].listeners&&delete c.names[d].listeners}c=c.names}}var i,j="hasOwnProperty",k={names:{}},l=/[\:]/,m=-1;return{add:f,remove:h,index:b,partial:c,_events:k,listeners:d,stop:e,once:g,dispatch:a}}),dmaf("_",["events","info"],function(a,b){function c(a){return{key:a,value:this[a]}}function d(a,b,c,d){this.type=a||"noteOn",this.midiNote=b||0,this.velocity=c||0,this.duration=d||0}function e(a,b){this.index=-1,this.array=a,this.getNext=u[b],this.A=a.slice(0),this.B=[]}function f(a){var b=g.getType(a);return b===l||b===m}var g={},h="int",i="float",j="string",k="boolean",l="object",m="array",n="undefined",o="function",p=g.op=Object.prototype,q=g.toString=p.toString,r="getAttribute",s="getElementsByTagName",t=[h,i,j,k,l,m,n,o];g.comma=/\,/,g.colon=/\:/,g.dot=/\./,g.plus=/\+/,g.bang=/\!/,g.separator=/[\:\.]/,g.whiteSpace=/\s+/g,g.accidental=/#|b/,g.digit=/-?\d/,g.cssUnit=/\%|px/,g.E="",g.NOTES={C:0,D:2,E:4,F:5,G:7,A:9,B:11},g.ACCIDENTALS={"#":1,b:-1},g.SCALES={off:null,major:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0],harmonicMinor:[0,1,0,0,-1,0,1,0,0,-1,1,0],naturalMinor:[0,-1,0,0,-1,0,-1,0,0,-1,0,-1],majorPentatonic:[0,1,0,1,0,-1,1,0,1,0,-1,1],minorPentatonic:[0,-1,1,0,-1,0,1,0,-1,1,0,-1],dorian:[0,1,0,0,-1,0,1,0,1,0,0,-1],phrygian:[0,0,-1,0,-1,0,1,0,0,-1,0,-1],lydian:[0,1,0,1,0,1,0,0,1,0,1,0],mixolydian:[0,1,0,1,0,0,-1,0,-1,0,-1],locrian:[0,0,-1,0,-1,0,0,-1,0,-1,0,-1],doubleHarmonic:[0,0,-1,1,0,0,1,0,0,-1,1,0],halfDim:[0,1,0,0,-1,0,0,-1,0,-1,0,-1],pentatonic:[0,-1,-2,0,-1,0,-1,0,-1,-2,0,-1]},g.EVENT_NAMES={down:b.touch?"touchstart":"mousedown",move:b.touch?"touchmove":"mousemove",up:b.touch?"mouseup":"mouseup",leave:b.touch?"touchleave":"mouseleave"},g.VENDOR_PREFIXES=["webkit","o","ms","moz"],g.CSS_PREFIXES=["-ms-","-webkit-","-moz-","-o-"],g.slice=Function.prototype.call.bind(Array.prototype.slice),g.max=function(a){return Math.max.apply(Math,a)},g.min=function(a){return Math.min.apply(Math,a)},g.average=function(a){return a.reduce(g.add,0)/a.length},g.indexOf=function(a,b){for(var c,d,e=0,f=b.length-1;f>=e;)if(c=(e+f)/2|0,d=b[c],a>d)e=c+1;else{if(!(d>a))return c;f=c-1}return-1},g.contains=function(a,b){return-1!==a.indexOf(b)},g.join=function(a){return[].concat.apply([],a)},g.concatAll=function(a,b){return a||(a=[]),a.concat(b)},g.pluck=function(a,b){return a.map(g.prop(b))},g.mapToObj=function(a,b){return{index:b,value:a}},g.uniq=function(a,b,c){return c.indexOf(a)===b},g.propSort=function(a){return function(b,c){return b[a]-c[a]}},g.initArray=function(a,b){for(var c=[],d=0;a>d;d++)c[d]=b&&b()||1;return c},g.onemap=function(a,b){for(var c=g.slice(a),d=0,e=a.length;e>d;d++)c[d]=b(a[d]);return c},g.defined=function(){for(var a=g.slice(arguments),b=a.length;b--;)if(void 0===a[b])return!1;return!0},g.constrain=function(b,c){return b>c.max&&(a.dispatch("log:error",b,"is out of range. constraining",c.name,"to:",c.max),b=c.max),b<c.min&&(a.dispatch("log:error",b,"is out of range. constraining",c.name,"to:",c.min),b=c.min),b},g.noWhiteSpace=function(a){return g.isType(j,a)?a.replace(g.whiteSpace,""):a},g.joinArgs=function(a){return g.slice(arguments,a?1:0).join(a||"")},g.fromString=function(b,c){if("undefined"==typeof c||"undefined"===c)return void 0;switch(b){case"string":return c;case"boolean":return"true"===c;case"int":return parseInt(c,10);case"float":return parseFloat(c);case"list":return c.split(g.comma);case"enum":return c;default:a.dispatch("log:error","DMAF convert string to value",b,c)}},g.bool=function(a){return"true"===a?!0:"false"===a?!1:a},g.capitalize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},g.curry=function(a){var b=g.slice(arguments,1);return function(){return a.apply(this,b.concat(g.slice(arguments)))}},g.autocurry=function(a,b){return b=b||a.length,function(){return arguments.length<b?b-arguments.length>0?g.autocurry(g.curry.apply(this,[a].concat(g.slice(arguments))),b-arguments.length):g.curry.apply(this,[a].concat(g.slice(arguments))):a.apply(this,arguments)}},g.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length;c;)b=[a[--c].apply(this,b)];return b[0]}},g.noop=function(){},g.call=function(a){a()},g.truthy=function(a){return!!a},g.falsy=function(a){return!a},g.add=function(a,b){return a+b},g.addRev=function(a,b){return b+a},g.adder=g.autocurry(g.add),g.appender=g.autocurry(g.addRev),g.subtract=function(a,b){return a-b},g.prop=function(a){return function(b){return b[a]}},g.is=function(a){return function(b){return a===b}},g.isnt=function(a){return function(b){return a!==b}},g.propIs=function(a,b){return function(c){return c[a]===b}},g.propIsnt=function(a,b){return function(c){return c[a]!==b}},g.defined=function(a){return g.propIsnt(a,void 0)},g.memoize=function(a){return function b(){var c=JSON.stringify(arguments);return"undefined"!=typeof b[c]?b[c]:b[c]=a.apply(this,arguments)}},g.throttle=function(a,b,c){var d=-1;return function(){var e=Date.now();e-d>b&&(a.apply(c,arguments),d=e)}},g.afterNTimes=function(a,b){function c(){++d===b&&(a.apply(this,arguments),d=0)}var d=0;return c.reset=function(){d=0},c},g.onlyOnce=function(a,b){var c=!1;return function(){c||(c=!0,a.apply(b||null,arguments))}},g.change=function(a){function b(){var b=JSON.stringify(arguments);return b!==c?(c=b,a.apply(this,arguments)):void 0}var c=null;return b.reset=function(){c=null},b},g.pipe=function(a){return a},g.getPipe=function(a){return function(){return a}},g.flipF=function(a){return function(){return a.apply(this,g.slice(arguments).reverse())}},g.isNode=function(a){return a?"undefined"==typeof a.localName&&"undefined"==typeof a.nodeName?!1:"undefined"==typeof a[r]?!1:!0:!1},g.attr=function(a,b){return a[r]&&a[r](b)||null},g.tag=function(a,b){return a[s]&&g.nodelistToArray(a[s](b))||[]},g.nodelistToArray=function(a){for(var b=[],c=b.length=a.length,d=0;c>d;d++)b[d]=a[d];return b.filter(g.truthy)},g.attrsToArray=function(a){return g.nodelistToArray(a.attributes).filter(g.prop("localName"))},g.children=function(a){return g.nodelistToArray(a.childNodes||[])||[]},g.getDefault=g.prop("default"),g.verify=function(b,c){var d;if(g.isType("undefined",b)||!b.type)return console.error("log:error","DMAF Verification Error: Malformed descriptor!"),void 0;if(g.isType("undefined",c))return g.getDefault(b);switch(b.type){case"int":if(c=parseInt(c,10),!g.isType(h,c)){d=!0;break}c=g.constrain(c,b);break;case"float":if(c=parseFloat(c),!g.isType(i,c)&&!g.isType(h,c)){d=!0;break}c=g.constrain(c,b);break;case"string":"undefined"===c&&(c=void 0),"string"!=typeof c&&(d=!0);break;case"list":d=!(c instanceof Array);break;case"enum":g.isType("array",b.values)?-1===b.values.indexOf(c)&&(a.dispatch("log:error",c,"is not valid enum for",b.name),d=!0):(a.dispatch("log:error","Malformed descriptors object",b.name),d=!0);break;case"boolean":d=!g.isType("boolean",c);break;default:a.dispatch("log:error","Malformed defaults object. Please check the descriptors.xml")}return d?(a.dispatch("log:error",c,"is not valid for",b.name),a.dispatch("log:error","Defaulting",b.name,"to",b["default"]),g.getDefault["default"]):c},g.innerText=function(a){return function(b){var c=b.getElementsByTagName(a);return c?c[0].innerText||c[0].textContent:""}},g.propertyModel={automatable:"boolean","default":"fromType",valueType:"string",value:"fromType",min:"fromType",max:"fromType",name:"string",type:"string",values:"list",unit:"string",src:"string"},g.isValidJSON=function(a){return"string"!=typeof a?"":/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))},g.set=function(a,b,c){var d,e;if(!a)return null;for(d=g.isType(m,b)?b:b.split(g.separator),e=d.shift();d.length;)a=g.isType(n,a[e])?a[e]={}:a[e],e=d.shift();return 1&&(a[e]=c)},g.get=function(a,b){var c,d;if(!a)return null;for(c=g.isType(m,b)?b:b.split(g.separator),d=c.shift();c.length;){if(g.isType(n,a[d]))return void 0;a=a[d],d=c.shift()}return!c.length&&a[d]||void 0},g.each=function(b,c,d){var e,f,h,i=0;if(g.isType(m,b))for(i=0,h=b.length;h>i&&!c.call(d,i,b[i]);i++);else if("object"==typeof b)for(e=Object.keys(b),i=0,h=e.length;h>i&&(f=e[i],"length"===f||!c.call(d,f,b[f]));i++);else a.dispatch("log:error","Not array or object",typeof b,b)},g.sortObj=function(a){return Object.keys(a).sort().reduce(function(b,c){return b[c]=a[c],b},{})},g.map=function(a,b){var c,d,e;if(g.isType(m,b))for(c=0,d=b.length;d>c;c++)b[c]=a(b[c],c);else if("object"==typeof b)for(e=Object.keys(b),c=0,d=e.length;d>c;c++)b[e[c]]=a(b[e[c]],e[c]);return b},g.extend=function(a,b){return g.each(a,function(a,c){g.isType(l,c)?g.extend(c,b[a]={}):g.isType(m,c)?g.extend(c,b[a]=[]):b[a]=c}),b},g.clone=function(b){var c;if(g.isType(l,b))c={};else{if(!g.isType(m,b))return a.dispatch("log:error","cannot clone non object",b),void 0;c=[]}return g.extend(b,c)},g.toArray=function(a){return Object.keys(a).map(c,a)},g.setImmediate=g.nextTick=function(a){setTimeout(a.apply.bind(a,this,g.slice(arguments,1)),0)},g.after=function(a,b,c){function d(){clearTimeout(e),e=setTimeout(f,b)}var e=0,f=g.onlyOnce(a);return d.cancel=function(){clearTimeout(e)},c&&(e=setTimeout(f,b)),d},g.dbToWAVolume=function(a){return Math.max(0,Math.floor(100*Math.pow(2,a/6))/100)},g.dbToJSVolume=function(a){return Math.min(1,g.dbToWAVolume(a))},g.toMidiNote=function(b){var c=g.NOTES[b[0]],d=g.accidental.exec(b.replace(/s/,"#")),e=g.digit.exec(b);return!g.isType(n,c)&&(d&&(c=(c+g.ACCIDENTALS[d[0]]+12)%12),e)?24+c+12*parseInt(e[0],10):(a.dispatch("log:error:utils",b+" is not a valid note."),void 0)},g.mToF=function(a){return 8.1757989156*Math.pow(2,a/12)},g.tanh=function(a){return(Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))},g.sign=function(a){return 0===a?1:Math.abs(a)/a},g.fmod=function(a,b){var c,d,e=0,f=0,g=0,h=0;return c=a.toExponential().match(/^.\.?(.*)e(.+)$/),e=parseInt(c[2],10)-(c[1]+"").length,c=b.toExponential().match(/^.\.?(.*)e(.+)$/),f=parseInt(c[2],10)-(c[1]+"").length,f>e&&(e=f),d=a%b,-100>e||e>20?(g=Math.round(Math.log(d)/Math.log(10)),h=Math.pow(10,g),(d/h).toFixed(g-e)*h):parseFloat(d.toFixed(-e))},g.makeNote=function(a,b,c,e){return new d(a,b,c,e)},g.isType=function(a,b){switch(a){case h:return b===+b&&b%1===0;case i:return b===+b;case n:return"undefined"==typeof b||"undefined"===b;case k:return"boolean"==typeof b;case j:return"string"==typeof b;case m:return"[object Array]"===q.call(b);case o:return"[object Function]"===q.call(b);case l:return"[object Object]"===q.call(b);default:return!1}},g.getType=function(a){return t.filter(function(b){return g.isType(b,a)}).shift()},g.UID=function(){for(var a="0123456789abcdef",b="",c=0;36>c;c++)b+=a.substr(~~(16*Math.random()),1);return b};var u={ROUND_ROBIN:function(){return this.index++,this.index%=this.array.length,this.array[this.index]},RANDOM_FIRST:function(){return-1===this.index?this.array[Math.floor(Math.random()*this.array.length)]:this.array[++this.index]},RANDOM:function(){return this.array[Math.floor(Math.random()*this.array.length)]},SHUFFLE:function(){var a;this.A.length||(this.A=this.array.slice(0),this.B=[]);do a=Math.floor(Math.random()*this.A.length);while(this.A[a]===this.previous);return this.B.push(this.A.splice(a,1)[0]),this.previous=this.B[this.B.length-1],this.previous}};return g.iterator=function(a,b){return new e(a,b)},g.multi=function(a,b,c){function d(h,i){"multi"===i?(c&&(this[h]=b),e=!0):f(i)&&i!==a&&g.each(i,d,i)}var e=!1;return a&&b?(b=g.isType(n,a.multiSuffix)?b:b.replace(a.multiSuffix,""),g.each(a,d,a),a.multi=e,a):console.error("Missing arguments for auto-multi!")},g.objOrArray=f,g.vendorPrefix=function(a,b){var c=g.capitalize(b);return g.VENDOR_PREFIXES.map(function(b){return a[b+c]}).filter(g.truthy).shift()||a[b]||null},g.isElement=function(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&null!==a&&1===a.nodeType&&"string"==typeof a.nodeName},g.addDOMListener=function(a,b,c){return b=g.EVENT_NAMES[b]||b,a.addEventListener(b,c,!1),c},g.removeDOMListener=function(a,b,c){b=g.EVENT_NAMES[b]||b,a.removeEventListener(b,c,!1)},g.onceDOMListener=function(a,b,c){function d(){a.removeEventListener(b,d,!1),c.apply(this,arguments)}return b=g.EVENT_NAMES[b]||b,a.addEventListener(b,d,!1),d},g.addClass=function(a,b){g.isElement(a)&&(a.classList?a.classList.add(b):new Regex(b).test(b)||(a.className+=" "+b))},g.removeClass=function(a,b){var c;if(g.isElement(a))if(a.classList)a.classList.remove(b);else{c=a.className.toString().split(g.whiteSpace).map(function(a){return a.trim()});var d=c.indexOf(b);-1!==d&&c.splice(d,1),a.className=c.join(" ")}},g.prefixCSS=function(a,b,c){return g.CSS_PREFIXES.forEach(function(d){a[d+b]=c}),a},g}),dmaf("ajax",["_","events","info"],function(a,b,c){function d(){for(var a in o)o[a]();o=void 0}function e(b){b.onload=b.onerror=b.ontimeout=b.onabort=a.noop}function f(a,b){var c=document.createElement("script");return c.src=a,c.async=!0,c.type="text/javascript",c.charset="utf-8",c.onload=c.onerror=b,c}function g(a,b){function c(c){switch(e(g),clearTimeout(d),l(g),c=c||{type:"noinfo"},c.type){case"load":b(null);break;case"error":b("404 (not found): "+a);break;default:b("Unknown Error: "+a)}}var d,g;g=f(a,c),document.head.appendChild(g)}function h(b,d,f,g,h,i,k,l){function p(f){return function(){var i="undefined"!=typeof this.status;if(i?i=this.status>=200&&this.status<300||304===this.status:q&&(i=!0),delete o[s],e(this),"error"===f||!i)return d("AJAX Error: "+b);if("abort"===f)return d("Request was aborted."),r.abort();if(!g){if(!a.isValidJSON(this.responseText))return d(null,this.response||this.responseText);g="json"}switch(g){case"document":var j;if(c.xhr2&&"object"==typeof this.response)j=this.response;else if("object"!=typeof this.responseXML||/html/.test(b))try{j=document.createElement("div"),j.innerHTML=this.responseText}catch(k){try{j=(new DOMParser).parseFromString(this.responseText,h)}catch(l){}}else j=this.responseXML;j?d(null,j):d("Missing or malformed response: "+b);break;case"json":"object"==typeof this.response?d(null,this.response):a.isValidJSON(this.responseText)?d(null,JSON.parse(this.responseText)):d("Invalid JSON response",b);break;case"arraybuffer":c.arraybuffer?this.response instanceof ArrayBuffer?d(null,this.response):d("Malformed arraybuffer response: "+b):d("Your browser doesn't support responseType arraybuffer: "+b);break;case"text":"string"==typeof this.responseText?d(null,this.responseText):d("Malformed Response: "+b);break;case"blob":}}}var q,r,s,t=!j.test(b)&&"."!==b[0];d=a.onlyOnce(d),"undefined"!=typeof o&&o||(o={},n=0);try{q=c.xdr&&t,"Explorer"===c.browser&&c.browserVersion>9&&(q=!1),r=q?new XDomainRequest:new XMLHttpRequest,q&&(r.onprogress=a.noop)}catch(u){d("Could not find transport: "+b)}if(r.open(f,b,!0),!q&&c.xhr2&&g&&"json"!==g&&(r.responseType=g),i&&"overrideMimeType"in r&&r.overrideMimeType(i),r.timeout=m,r.onload=p(),r.onerror=p("error"),r.ontimeout=p("error"),r.onabort=o[s=n++]=p("abort"),k&&!q)for(var v in k)r.setRequestHeader(v,k[v]);try{r.send(l||null)}catch(w){d("Error sending reqest: "+b)}}function i(a){return a.value&&a.key?encodeURIComponent(a.key.replace(" ","+"))+"="+encodeURIComponent(a.value.toString().replace(" ","+")):""}if(!c.web)return{};var j=new RegExp(location.hostname||location.host),k=document.head||document.querySelector("head"),l=document.removeChild.bind(k),m=3e4,n=0,o={};a.getScript=g,a.getDocument=function(a,b){var c=/\.html/.test(a)?"text/html":/\.xml/.test(a)?"text/xml":"";return h(a,b,"GET","document",c)},a.getJSON=function(a,b){return h(a,b,"GET","json")},a.getArrayBuffer=function(a,b){return h(a,b,"GET","arraybuffer")},a.getMIDI=function(a,b){return h(a,b,"GET","text","text/plain","text/plain; charset=x-user-defined")},a.getImg=function(b,c){var d=document.createElement("img");d.onload=a.curry(c,null,d),d.onerror=a.curry(c,"Could not load img"+b),d.src=b},a.getText=function(a,b){return h(a,b,"GET","text","text/plain")},a.post=function(b,c,d,e){return h(c,d||a.noop,"POST",null,null,null,b,e)},a.encodeQuery=function(b){return b&&a.isType("object",b)?a.toArray(b).map(i).join("&"):(dmaf.error("encodeData: Missing parameters"),"")},a.decodeQuery=function(a){for(var b,c,d=a.split(/\?/),e="",f={},g=0;g<d.length;g++)(!/http|https/.test(d[g])||/dmaf/.test(d[g]))&&(e=d[g].split("="),d.length>1&&(b=e[0],c=e[1],f[decodeURI(b)]=decodeURI(c)));return f},a.xhr=h,"ActiveXObject"in window&&window.addEventListener("unload",d)}),dmaf("async",["_"],function(a){function b(b){return function(){return b.apply(null,[f.each].concat(a.slice(arguments)))}}function c(b){return function(){return b.apply(null,[f.eachSeries].concat(a.slice(arguments)))}}function d(b,c,d,e){var f=[];c=c.map(a.mapToObj),b(c,function(a,b){d(a.value,function(c,d){f[a.index]=d,b(c)})},function(a){e(a,f)})}function e(b,c,d){if(d=d||a.noop,a.isType("array",c))b.map(c,function(b,c){b&&b(function(b){var d=a.slice(arguments,1);d.length<=1&&(d=d[0]),c.call(null,b,d)})},d);else{var e={};b.each(Object.keys(c),function(b,d){c[b](function(c){var f=a.slice(arguments,1);f.length<=1&&(f=f[0]),e[b]=f,d(c)})},function(a){d(a,e)})}}var f={each:function(b,c,d){if(d=d||a.noop,!b.length)return d();var e=0;b.forEach(function(f){c(f,a.onlyOnce(function(c){c?(d(c),d=a.noop):++e>=b.length&&d(null)}))})},eachSeries:function(b,c,d){function e(){c(b[f],function(c){c?(d(c),d=a.noop):++f>=b.length?d(null):e()})}if(d=d||a.noop,!b.length)return d();var f=0;e()},iterator:function(a){function b(c){function d(){return a.length&&a[c].apply(null,arguments),d.next()}return d.next=function(){return c<a.length-1?b(c+1):null},d}return b(0)},map:b(d),mapSeries:c(d),parallel:function(a,b){e({map:f.map,each:f.each},a,b)},series:function(b,c){if(c=c||a.noop,a.isType("array",b))f.mapSeries(b,function(b,c){b&&b(function(b){var d=a.slice(arguments,1);d.length<=1&&(d=d[0]),c.call(null,b,d)})},c);else{var d={};f.eachSeries(Object.keys(b),function(c,e){b[c](function(b){var f=a.slice(arguments,1);f.length<=1&&(f=f[0]),d[c]=f,e(b)})},function(a){c(a,d)})}},waterfall:function(b,c){if(c=c||a.noop,!b.length)return c();var d=function(b){return function(e){if(e)c.apply(null,arguments),c=a.noop;else{var f=a.slice(arguments,1),g=b.next();g?f.push(d(g)):f.push(c),a.setImmediate(function(){b.apply(null,f)})}}};d(f.iterator(b))()}};return f}),dmaf("parse",["_"],function(a){function b(b){var c=[];return a.each(b,function(a,b){"array"===b.type&&c.push(b)}),c}function c(b){var c,d;return a.each(u.action,function(e,f){return a.each(f,function(a,d){return a===b&&(c=d),c}),c?d=e:!1}),{descriptor:c,type:d,id:b}}function d(b,c,d){if(a.whiteSpace.test(d))throw new RangeError(b+" in "+c.name+" may not contain white space.")}function e(a){if(!u.validActions[a.name])throw new TypeError("Unrecognized action: "+a.name)}function f(b){return a.colon.test(b.value)&&!/target/.test(b.name)&&!/http|_external/.test(b.value)}function g(b,c,d){var e;b.attrs.forEach(function(a){if(!c[a.name]&&"multiSuffix"!==a.name)throw new TypeError("Unrecognized property "+a.name)}),b.attrs.forEach(function(b){f(b)?(d._dynamicValues=d._dynamicValues||[],d._dynamicValues.push({key:b.name,value:b.value}),d._key=c[b.name]["default"]):"multiSuffix"===b.name?d.multiSuffix=b.value:(e=a.fromString(c[b.name].type,b.value),d[b.name]=a.verify(c[b.name],e))})}function h(a){if(this[a.name]&&"array"===this[a.name].type)return a.valueType=this[a.name].valueType,a;if("properties"===a.name||this[a.name])return!1;throw new TypeError("Unrecognized property "+a.name)}function i(c,d){var e=u.type[c.valueType];if(!e)throw new TypeError("Invalid array "+c.name+" in "+d.id);c.children.forEach(function(a){if(!e[a.name])throw new TypeError("Invalid element: "+a.name+" in array "+d.id+"."+c.name)}),d[c.name]=c.children.map(function(d){var f={id:d.name},h=b(e[d.name]);if(g(d,e[d.name],f),!h.length&&d.children.length)throw dmaf.log&&console.log("List of tags found:",d.children.map(a.prop("name")).join(",")),new TypeError("Found unrecognized child array in "+d.name);return a.each(h,function(b,e){var g=d.children.filter(a.propIs("name",e.name));if(!g.length||1!==g.length)throw new Error("Missing child array "+e.name+" from "+c.name);g=g.pop(),g.valueType=e.valueType,i(g,f)}),f})}function j(b){var e=c(b.name),f=e.descriptor,j=b.attrs.reduce(function(c,e){return d(e.name,b,e.value),c[e.name]="triggers"===e.name?e.value.split(a.comma):e.value,c},{});if(j.type=e.type,j.id=e.id,j.requires=f.requires||null,!j.triggers)throw new Error("Missing triggers "+j.type+" "+j.id);var k=b.children.filter(a.propIs("name","properties")),l=b.children.filter(h,f);return a.each(k,function(a,b){g(b,f,j)}),Object.keys(f).filter(a.isnt("instanceId")).forEach(function(b){var c=!1;if(l.forEach(function(a){a.name===b&&(c=!0)}),a.each(j,function(a){a===b&&(c=!0)}),!c)throw new Error("Missing property "+b+" in "+j.id+":"+(j.instanceId||""))}),a.each(l,function(a,b){i(b,j)}),u.usedTypes.push(j.type),u.usedIds.push(j.id),j}function k(b){var c;return b.forEach(e),c=b.map(j),u.usedTypes=u.usedTypes.filter(a.uniq),u.usedIds=u.usedIds.filter(a.uniq),c}function l(a){if(!v.property.test(a.name))throw new TypeError("Unrecognized descriptor property: "+a.name);return a}function m(a){if(!v.descriptor.test(a.name))throw new TypeError("Unrecognized descriptor attribute: "+a.name);return a}function n(b,c){if("fromType"!==a.propertyModel[b])return a.propertyModel[b];for(var d=0;d<c.attrs.length;d++)if("type"===c.attrs[d].name)return c.attrs[d].value}function o(a){for(var b,c=[],d=0,e=a.length;e>d;d++)switch(b=a[d],b.name){case"requires":break;case"class":c[0]=b.value;break;case"type":c[1]=b.value;break;case"id":c[2]=b.value}return c}function p(b){var c={},d=b.attrs.filter(a.propIs("name","requires")).map(a.prop("value")).pop(),e=o(b.attrs);b.attrs.forEach(m),b.children.forEach(function(b){var d;if("property"!==b.name)throw new TypeError("Invalid attribute: "+b.name+" in descriptors.");d=b.attrs.map(l).filter(a.propIs("name","name")).pop().value,c[d]={},b.attrs.forEach(function(e){c[d][e.name]=a.fromString(n(e.name,b),e.value)})}),-1!==e.indexOf("action")&&(u.validActions[a.slice(e).pop()]=!0),Object.defineProperty(c,"requires",{value:d||null,enumerable:!1}),a.set(u,e,c)}function q(a){if(u={validActions:{},usedIds:[],usedTypes:[]},a=a&&a[0]&&a[0].children)return a.forEach(p),u;throw new Error("Malformed descriptors!")}function r(a){return{name:a.nodeName,value:a.value}}function s(b){return{name:b.localName||b.nodeName,attrs:a.nodelistToArray(b.attributes).map(r),innerText:(b.innerText||b.textContent||"").replace(/^\s*[\r\n]/gm,""),children:a.nodelistToArray(b.childNodes).filter(a.isNode).map(s)}}function t(b){if(!b)return console.log("missing xml.");var c=a.nodelistToArray(b.childNodes).filter(a.isNode).map(s);return c}var u,v={descriptor:/class|type|id|requires/,property:/name|min|max|type|default|values|valueType/};return{xml:t,descriptors:q,actions:k}}),dmaf("actions",["events","_","instances","public","time"],function(a,b,c,d,e){function f(a,c){return function(d,f,g){f=(f||e.current)+(a.delay||0),c(d,f,g,b.multi(b.clone(a),d,!0))}}function g(a,b){return function(c,d,f){d=(d||e.current)+(a.delay||0),b(c,d,f,a)}}var h={},i=[],j={register:function(a,c,d){b.set(h,[a,c],d)},get:function(a){return b.get(h,a)},getActive:function(a){return i.filter(function(b){return b===a}).pop()||null},add:function(c){var d=b.get(h,[c.type,c.id]);return d?(b.multi(c,"___",!1),d=c.multi?f(c,d):g(c,d),d.triggers=c.triggers,d.data=c,c.triggers.forEach(function(b){a.add(b,d)}),i.push(d),void 0):a.dispatch("log:error:actions","Invalid action "+c.id)},remove:function(b){var c=i.splice(i.indexOf(b),1).pop();c?b.triggers.forEach(function(b){a.remove(b,c)}):a.dispatch("log:warn:actions","Could not find action",b.id)}};return j}),dmaf("assets",["events"],function(a){var b={html:{},beatPattern:{},timePattern:{},sampleMap:{},buffer:{},img:{}};return{get:function(c,d){return b[c]&&b[c][d]?b[c][d]:(a.dispatch("log:error:asset","Couldn't find asset",c,d),null)},set:function(a,c,d){return b[a]?(b[a][c]?dmaf.log("Asset already exists!",a,c):b[a][c]=d,void 0):console.error("invalid asset",a)},remove:function(a,c){b[a]&&b[a][c]&&delete b[a][c]}}}),dmaf("audioManager",["events","assets","core","time","_","info"],function(a,b,c,d,e,f){function g(){return document.createElement("AUDIO")}function h(){var a=g();return a.type=f.audioType,a.addEventListener("canplaythrough",l,!1),a.addEventListener("error",i,!1),a.addEventListener("ended",j,!1),a.addEventListener("pause",j,!1),a.addEventListener("playing",k,!1),a}function i(){return 4===this.error.code?m.call(this):(a.dispatch("log:error:audio",this.error.code),void 0)}function j(){this.playing=!1,a.dispatch("_internal:audio:"+this.id+".STOPPED",this)}function k(){this.playing=!0,this.timestamp=d.current}function l(){this.loaded=!0,this.removeEventListener("suspend",m,!1),this.removeEventListener("stalled",m,!1),a.dispatch("_internal:audio:"+this.id+".READY",this)}function m(){this.play(),e.nextTick(n.bind(this))}function n(){try{this.pause()}catch(a){}}function o(a,b){return a.id=b,a.loaded=!1,a.timestamp=d.current,a.volume=0,a.src=u+b+f.audioFormat,a.addEventListener("suspend",m,!1),a.addEventListener("stalled",m,!1),m.call(a),a}function p(b){var c=t.filter(e.propIs("id",b)).shift();return c?a.dispatch("_internal:audio:"+b+".ERROR",b+" is already loaded."):(c=t.sort(y).filter(x).shift(),c?o(c,b):z.push(b),void 0)}function q(a){{var b=t.sort(y).filter(x).filter(e.propIs("id",a)).shift();t.filter(e.propIs("id",a)).length}return b?b.loaded?!0:(b.load(),!0):(b=t.filter(x).shift(),b?(o(b,a),!0):(console.error("Maximum audioElementVoice count",s,"reached. Cannot play sound",a),!1))}function r(a,b){var c=t.filter(w).filter(e.propIs("id",a)).shift();return c&&!(b.loop>-1||b.reTrig>-1)?(console.error(a,"is already active!"),null):(c=t.sort(y).filter(x).filter(e.propIs("id",a)).shift(),c&&c.loaded?(c.active=!0,c):(c=t.filter(x).shift(),c?(c.active=!0,o(c,a),c):(console.error("Maximum audioElementVoice count",s,"reached. Cannot play sound",a),null)))}if(f.webaudio&&"HTML_AUDIO"!==c.audioMode||"FALLBACK"!==c.audioMode)return{};var s=c.htmlAudioVoiceCount||32,t=e.initArray(s,h),u=c.assetsPath+"audio/",v=Object.getPrototypeOf(document.createElement("audio")),w=e.prop("active"),x=e.propIsnt("active",!0),y=e.propSort("timestamp"),z=[];return v.loaded=!1,v.playing=!1,v.timestamp=d.current,v._active=!1,Object.defineProperty(v,"active",{get:function(){return this._active},set:function(b){b||a.dispatch("_internal:audio:element_free"),this._active=b
}}),a.add("_internal:audio:element_free",function(){z.length&&p(z.shift())}),{loadElement:p,requestElement:r,prepareDuplicate:q}}),dmaf("context",["info","core"],function(a,b){function c(a){a.proto[a.name]=a.proto[a.name]||a.shim}function d(a,b,c){return{name:a,shim:b,proto:c}}function e(a,b,c){return 1===arguments.length?this.noteOn(a):this.noteGrainOn(a,b,c)}function f(a){document.removeEventListener(a.type,f,!1);var c=b.require("context"),d=c.createBufferSource();d.buffer=c.createBuffer(1,100,44100),d.noteOn(0)}function g(a){var b=Object.getPrototypeOf(a.createBufferSource()),f=Object.getPrototypeOf(a);return[d("createGainNode",f.createGain,f),d("createGain",f.createGainNode,f),d("createDelayNode",f.createDelay,f),d("createDelay",f.createDelayNode,f),d("createJavaScriptNode",f.createScriptProcessor,f),d("createScriptProcessor",f.createJavaScriptNode,f),d("start",e,b),d("noteOn",b.start,b),d("noteGrainOn",b.start,b),d("stop",b.noteoff,b),d("noteOff",b.stop,b)].forEach(c),a}function h(b){return document.addEventListener(a.touch?"touchstart":"mousemove",f,!1),g(new b)}return a.webaudio&&h(window.webkitAudioContext||window.AudioContext)}),dmaf("instances",["events","_","context","core","info","time","tween"],function(a,b,c,d,e,f,g){var h={init:b.noop,construct:b.noop,returnChildInstance:function(a){var c,d,e;if(b.colon.test(a)&&(d=a.split(b.colon),d.length>1))for(e=d.shift(),c=this;d.length;){if(c=c[e],h.isPrototypeOf(c))return c.returnChildInstance(d.join(":"));if("object"!=typeof c)break;e=d.shift()}return{instance:this,ref:a}},setDynamicValues:function(){return this._dynamicValues.forEach(function(a){this[a.key]=b.verify(this.defaults[a.key],i.get(a.string))},this),this},setProperty:function(a,c,d,e){var h,i,j,k=this.returnChildInstance(a);return k.instance!==this?k.instance.setProperty(k.ref,c,d,e):b.colon.test(a)?this.error("Unsupported dynamic string:",a):b.isType("undefined",this[a])?this.error("Invalid property",a):(m.isPrototypeOf(this[a])?(e=e?e/1e3:0,d=d&&d>0?d/1e3:0,"volume"===a&&(c=Math.max(0,Math.floor(100*Math.pow(2,c/6))/100)),h=d?"linearRampToValueAtTime":"setValueAtTime",this[a].cancelScheduledValues(e),this[a].setValueAtTime(this[a].value,e),this[a][h](c,d+e)):this.animate?this.animate(e,a,c,d):isNaN(this[a])?this[a]=c:(this._transforms[a]&&this._transforms[a].stop(),i=this._transforms[a]=new g.Tween(this),j={},j[a]=c,i.to(j,d),f.schedule(e,function(){i.start(0)},0)),void 0)},log:dmaf.log?function(){var c=b.slice(arguments);c.unshift("log:instance:"+this.type+":"+this.id+":"+this.instanceId),a.dispatch.apply(a,c)}:b.noop,error:dmaf.log?function(){var c=b.slice(arguments);c.unshift("log:error:instance:"+this.type+":"+this.id+":"+this.instanceId),a.dispatch.apply(a,c)}:b.noop,critical:function(){var a=b.slice(arguments);a.unshift(this.type+this.id+this.instanceId),console.error.apply(console,arguments)}},i={register:function(c,e){if(j[c]){var f=Object.create(j[c],e);return Object.defineProperties(f,{defaults:{value:b.get(d.descriptors,[c,f.id])||{}}}),b.set(k,[f.type,f.id],f)}return"Type"===c?b.set(j,[e.type.value],Object.create(h,e)):(a.dispatch("log:error:instance","Didn't find type",c,e),void 0)},getType:function(a){return j[a]||null},getId:function(a){return k[a]||null},get:function(a){return arguments.length>1&&(a=b.slice(arguments)),b.get(l,a)},set:function(a,c){return b.set(l,a,c)},remove:function(a,c){var d=b.get(l,a);return delete d[c]},create:function(c){var d,e=b.get(k,[c.type,c.id]);return e?(d=Object.create(e),d._transforms=Object.create(null),d.construct(c),b.extend(c,d),d._dynamicValues&&d.setDynamicValues(),d.init(c),b.set(l,[d.type,d.instanceId],d),d):(a.dispatch("log:error:instance",c.id+" is not a valid instance!"),void 0)},vivify:function(c){var d=b.get(l,[c.type,c.instanceId]);return d||(d=this.create(c)),d?(d._dynamicValues&&d.setDynamicValues(),d):(a.dispatch("log:error:instance","Missing instance constructor!",c.type,c.id),null)}},j={},k={},l={},m=e.webaudio?Object.getPrototypeOf(c.createGainNode().gain.constructor.prototype):{};return i}),dmaf("property",["time","_"],function(a){function b(b,c,e,f){var g=a.current;this.time=b,this.value=c,this.parent=f,this.type=e,this.execute=("linear"===e?d:this.done).bind(this),"linear"===e&&(b=this.parent._previous),this.id=setTimeout(this.execute,b>g?b-g:0)}function c(){this.startTime=this.parent._previous,this.startValue=this.parent.value}function d(){var b;void 0===this.startTime&&c.call(this),b=(a.current-this.startTime)/(this.time-this.startTime),this.parent.value=this.startValue+(this.value-this.startValue)*b,b>.999?this.done():this.id=setTimeout(this.execute,20)}function e(a){this.value=a,this._previous=0,this._actions=[]}return b.prototype.done=function(){this.parent._previous=this.time,this.parent.value=this.value,this.parent._actions.splice(this.parent._actions.indexOf(this),1)},e.prototype.cancelScheduledValues=function(a){for(var b=this._actions.length;b--;)this._actions[b].time>=a&&this._actions.splice(b,1)},e.prototype.setValueAtTime=function(a,c){this._actions.push(new b(c,a,"set",this))},e.prototype.linearRampToValueAtTime=function(a,c){this._actions.push(new b(c,a,"linear",this))},e}),dmaf("public",["core","events","_","instances","time"],function(a,b,c,d,e){function f(b){c.each(h[b],function(b,d){dmaf[b]=d,a.pending.filter(c.propIs("name",b)).pop().pending.forEach(function(a){dmaf[b].apply(dmaf,a)})})}var g={},h={listeners:{once:function(a,c){return b.once("_external:"+a,c),dmaf},addEventListener:function(a,c){return b.add("_external:"+a,c),dmaf},removeEventListener:function(a,c){return b.remove("_external:"+a,c),dmaf},unregisterObject:function(a){return b.dispatch("log:public:unregisterObject",a),delete g[a],d.get("customCode",a)&&d.remove("customCode",a),b.dispatch(a+".REMOVE"),dmaf},fail:function(a){return b.once("dmaf_fail",a),dmaf},ready:function(a){return b.once("dmaf_ready",a),dmaf}},input:{tell:function(a,c,d){return b.dispatch("log:public:tell",a,c),b.dispatch(a,d||e.current,c),dmaf},registerObject:function(a,c){if(b.dispatch("log:public:registerObject",a,c),"string"!=typeof a||"object"!=typeof c)throw new TypeError("dmaf.registerObject: invalid type. Please use signature:\n dmaf.registerObject(string, object);");if(g[a])throw new TypeError("dmaf.registerObject: Object with id "+a+" has already been registered. Please call dmaf.unregisterObject(id) first.");return g[a]=c,b.dispatch(a+".CREATE",e.current,{id:a,obj:c}),dmaf}}};dmaf("registeredObjects",[],g),b.once("_internal:resolve_listeners",f.bind(null,"listeners")),b.once("_internal:resolve_input",f.bind(null,"input"))}),dmaf("time",["context","_","events","core","info"],function(a,b,c,d,e){function f(){return 1e3*a.currentTime}function g(){return Date.now()-n}function h(){return performance.now()}function i(){var a=0,b=o.length;if(b)for(setTimeout(i,m.preListen),l=m.current;b>a&&o[a];a++)o[a](l)}function j(){var a=0,b=p.length;if(b)for(requestAnimationFrame(j),l=m.current;b>a&&p[a];a++)p[a](l)}function k(a,b,c){this.pending=[],this.preListen=void 0===c?m.preListen:c,this.f=b.apply.bind(b,a),this.valueOf=function(){return this.pending.length}}var l,m=Object.create(null,{current:{get:e.webaudio?f:e.now?h:g},ticking:{get:function(){return!!o.length}},animating:{get:function(){return!!p.length}}}),n=Date.now(),o=[],p=[];return m.preListen=d.preListen||30,b.getCurrentTime=e.webaudio?f:e.now?h:g,k.prototype.cancel=function(){for(;this.pending&&this.pending.length;)clearTimeout(this.pending.shift())},k.prototype.schedule=function(a){var c=this.f.bind(null,b.slice(arguments,1));l=m.current,a>=l+this.preListen?this.pending.push(setTimeout(c,a-l-this.preListen)):c()},m.clearDelay=clearTimeout,m.schedule=function(a,c,d){var e,f=b.slice(arguments,3);return d=void 0===d?m.preListen:d,l=m.current,a>=l+d?(e=setTimeout(c.apply.bind(c,this,f),a-l-d),clearTimeout.bind(window,e)):(c.apply(this,f),b.noop)},m.addTicker=function(a,d,e){if(o.filter(b.propIs("id",a)).shift())return c.dispatch("log:error:time","Frame listener",a,"is already running");var f=d.bind(e);f.id=a,o.push(f),i()},m.removeTicker=function(a){o=o.filter(b.propIsnt("id",a))},m.addFrameListener=function(a,d,e){if(p.filter(b.propIs("id",a)).shift())return c.dispatch("log:error:time","Frame listener",a,"is already running");var f=d.bind(e||null);f.id=a,p.push(f),j()},m.removeFrameListener=function(a){p=p.filter(b.propIsnt("id",a))},m.createScheduler=function(a,b,c){return new k(a,b,c)},m}),dmaf("tween",["time"],function(a){var b=function(){var b=[];return{REVISION:"11dev",getAll:function(){return b},removeAll:function(){b=[]},add:function(a){b.push(a)},remove:function(a){var c=b.indexOf(a);-1!==c&&b.splice(c,1)},update:function(c){if(0===b.length)return!1;c=a.current;for(var d=0;d<b.length;d++)b[d]&&b[d].update(c)||b.splice(d,1);return!0}}}();return b.Tween=function(c){var d=c,e={},f={},g={},h=1e3,i=0,j=!1,k=!1,l=0,m=null,n=b.Easing.Linear.None,o=b.Interpolation.Linear,p=[],q=null,r=!1,s=null,t=null;for(var u in c)"number"==typeof c[u]&&(e[u]=parseFloat(c[u],10));this.to=function(a,b){return void 0!==b&&(h=b),f=a,this},this.start=function(){b.add(this),r=!1,m=a.current,m+=l;for(var c in f){if(f[c]instanceof Array){if(0===f[c].length)continue;f[c]=[d[c]].concat(f[c])}e[c]=d[c],e[c]instanceof Array==!1&&(e[c]*=1),g[c]=e[c]||0}return this},this.stop=function(){return b.remove(this),this},this.delay=function(a){return l=a,this},this.repeat=function(a){return i=a,this},this.yoyo=function(a){return j=a,this},this.easing=function(a){return n=a,this},this.interpolation=function(a){return o=a,this},this.chain=function(){return p=arguments,this},this.onStart=function(a){return q=a,this},this.onUpdate=function(a){return s=a,this},this.onComplete=function(a){return t=a,this},this.update=function(a){var b;if(m>a)return!0;r===!1&&(null!==q&&q.call(d),r=!0);var c=(a-m)/h;c=c>1?1:c;var u=n(c);for(b in f){var v=e[b]||0,w=f[b];w instanceof Array?d[b]=o(w,u):("string"==typeof w&&(w=v+parseFloat(w,10)),"number"==typeof w&&(d[b]=v+(w-v)*u))}if(null!==s&&s.call(d,u),1==c){if(i>0){isFinite(i)&&i--;for(b in g){if("string"==typeof f[b]&&(g[b]=g[b]+parseFloat(f[b],10)),j){var x=g[b];g[b]=f[b],f[b]=x,k=!k}e[b]=g[b]}return m=a+l,!0}null!==t&&t.call(d);for(var y=0,z=p.length;z>y;y++)p[y].start(a);return!1}return!0}},b.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return(a*=2)<1?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return(a*=2)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:(a*=2)<1?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),-(c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d)))},Out:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),c*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/d)+1)},InOut:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),(a*=2)<1?-.5*c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d):c*Math.pow(2,-10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d)*.5+1)}},Back:{In:function(a){var b=1.70158;return a*a*((b+1)*a-b)},Out:function(a){var b=1.70158;return--a*a*((b+1)*a+b)+1},InOut:function(a){var b=2.5949095;return(a*=2)<1?.5*a*a*((b+1)*a-b):.5*((a-=2)*a*((b+1)*a+b)+2)}},Bounce:{In:function(a){return 1-b.Easing.Bounce.Out(1-a)},Out:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*b.Easing.Bounce.In(2*a):.5*b.Easing.Bounce.Out(2*a-1)+.5}}},b.Interpolation={Linear:function(a,c){var d=a.length-1,e=d*c,f=Math.floor(e),g=b.Interpolation.Utils.Linear;return 0>c?g(a[0],a[1],e):c>1?g(a[d],a[d-1],d-e):g(a[f],a[f+1>d?d:f+1],e-f)},Bezier:function(a,c){var d,e=0,f=a.length-1,g=Math.pow,h=b.Interpolation.Utils.Bernstein;for(d=0;f>=d;d++)e+=g(1-c,f-d)*g(c,d)*a[d]*h(f,d);return e},CatmullRom:function(a,c){var d=a.length-1,e=d*c,f=Math.floor(e),g=b.Interpolation.Utils.CatmullRom;return a[0]===a[d]?(0>c&&(f=Math.floor(e=d*(1+c))),g(a[(f-1+d)%d],a[f],a[(f+1)%d],a[(f+2)%d],e-f)):0>c?a[0]-(g(a[0],a[0],a[1],a[1],-e)-a[0]):c>1?a[d]-(g(a[d],a[d],a[d-1],a[d-1],e-d)-a[d]):g(a[f?f-1:0],a[f],a[f+1>d?d:f+1],a[f+2>d?d:f+2],e-f)},Utils:{Linear:function(a,b,c){return(b-a)*c+a},Bernstein:function(a,c){var d=b.Interpolation.Utils.Factorial;return d(a)/d(c)/d(a-c)},Factorial:function(){var a=[1];return function(b){var c,d=1;if(a[b])return a[b];for(c=b;c>1;c--)d*=c;return a[b]=d}}(),CatmullRom:function(a,b,c,d,e){var f=.5*(c-a),g=.5*(d-b),h=e*e,i=e*h;return(2*b-2*c+f+g)*i+(-3*b+3*c-2*f-g)*h+f*e+b}}},a.addFrameListener("tween_update",b.update),b}),dmaf("assetController",["actions","instances","async","events","_","assets"],function(a,b,c,d,e,f){function g(a,c,d,e){b.vivify(e).load(a)}function h(a,c,d,e){b.get("assetController",e.target),b.vivify(e).unload()}b.register("Type",{type:{value:"assetController"},init:{value:function(){this.files=e.pluck(this.files,"name")}},load:{value:function(a){var b=this;b.log("started"),c.each(this.files,this.iterator.bind(this),function(c){return c?b.error(c):(b.returnEvent&&d.dispatch(b.returnEvent),"preload_assets"===a&&d.dispatch("_internal:preload_complete"),b.log("Completed"),void 0)})}},dispatchProgress:{value:function(a,b){d.dispatch("_internal:progress",{percent:b,id:a})}},unload:{value:function(){this.files.forEach(f.remove.bind(f,this.assetType))}}}),a.register("assetController","load",g),a.register("assetController","unload",h)}),dmaf("audioRouter",["instances"],function(a){a.register("Type",{type:{value:"audioRouter"}})}),dmaf("control",["instances"],function(a){a.register("Type",{type:{value:"control"}})}),dmaf("eventProcessor",["instances","_"],function(a){a.register("Type",{type:{value:"eventProcessor"}})}),dmaf("customCode",["instances"],function(a){a.register("Type",{type:{value:"customCode"}})}),dmaf("element",["instances"],function(a){a.register("Type",{type:{value:"element"}})}),dmaf("sound",["events","instances","_","context","time","assets"],function(a,b,c,d,e,f){var g=c.propIsnt("playbackState",3);b.register("Type",{type:{value:"sound"},construct:{value:function(){this.output=d.createGainNode(),this.plays=e.createScheduler(this,this.proceedPlay),this.stops=e.createScheduler(this,this.proceedStop),this.events=e.createScheduler(a,a.dispatch),this.softLoops=e.createScheduler(this,this.proceedPlay),this.disposes=e.createScheduler(this,this.dispose),this.sounds=[],this.playing=!1,this.lastExecuted=-1}},init:{value:function(){this.outputs.forEach(function(a){var c;"master"===a?this.output.connect(d.destination):(c=b.get("audioRouter."+a),c?this.output.connect(c.input):this.log("Can't find bus",a))},this)}},checkFinished:{value:function(){this.sounds=this.sounds.filter(g),this.playing=!!this.sounds.length}},clearAll:{value:function(a,b){this.log("clearAll",a);var c;for(b=b||0;this.sounds.length;){if(c=this.sounds.pop(),c.playbackState<=2){this.log("clearing playing sound"),c._gain.gain.cancelScheduledValues(a/1e3),c._gain.gain.setValueAtTime(c._gain.gain.value,a/1e3),c._gain.gain.linearRampToValueAtTime(0,(a+b)/1e3);try{c.noteOff((a+b)/1e3)}catch(d){}}else this.log("clearing not started, or finished sound.");delete c._gain}this.playing=!1}},createSound:{value:function(){var a=d.createBufferSource(),b=f.get("buffer",this.getSoundFile()),e=d.createGainNode();return b?(a.id=c.UID(),a._gain=e,a.buffer=b,a.connect(e),e.connect(this.output),-2===this.loop&&(a.loop=!0),a):(this.log("Buffer is missing. Check soundFile property."),null)}},dispose:{value:function(a){this.sounds=this.sounds.filter(c.propIsnt("id",a)),this.playing=!!this.sounds.length}},play:{value:function(a){var b=e.current;this.checkFinished(),this.stops.cancel(),this.log("play",a),this.playing?(this.reTrig>-1&&(this.plays.cancel(),this.events.cancel()),0===this.reTrig||"RESYNC"===this.timingCorrection?(this.log("scheduling for: "+a),this.plays.schedule(a,a)):this.reTrig>0&&b-this.lastExecuted>this.reTrig&&(this.lastExecuted=b,this.log("scheduling for: "+a),this.plays.schedule(a,a))):(this.lastExecuted=b,this.log("scheduling for: "+a),this.plays.schedule(a,a))}},proceedPlay:{value:function(a){var b,c,d,f=this.createSound(),g=e.current;if(this.log("proceedPlay",a),f){if(c=1e3*f.buffer.duration,0===this.loop&&(this.loop=c),"PLAY"===this.timingCorrection)g>a&&(a=g),f.noteOn(a/1e3);else{if("RESYNC"===this.timingCorrection&&this.clearAll(a,this.fadeOut),this.loop>-1)for(;g>=a+this.loop;)a+=this.loop;else if(g>a+c)return this.log("Sync or resync sound start time was after buffer."),void 0;g>a?(b=g-a,f.noteGrainOn(g/1e3,b/1e3,(c-b)/1e3)):f.noteOn(a/1e3)}this.fadeIn>0&&(g>a?(f._gain.gain.setValueAtTime(0,g/1e3),f._gain.gain.linearRampToValueAtTime(1,g/1e3+this.fadeIn/1e3)):(f._gain.gain.setValueAtTime(0,a/1e3),f._gain.gain.linearRampToValueAtTime(1,a/1e3+this.fadeIn/1e3))),this.events.cancel(),this.returnEvent&&(d=a+c+this.returnEventTime,this.events.schedule(d,this.returnEvent,d)),this.loop>-1?(this.softLoops.schedule(a+this.loop,a+this.loop),this.disposes.schedule(a+this.loop,f.id),f.noteOff(a/1e3+f.buffer.duration)):this.disposes.schedule(a+c,f.id),this.playing=!0,this.sounds.push(f)}}},stop:{value:function(a){this.log("stop",a),this.plays.cancel(),this.stops.cancel(),this.stops.schedule(a,this.fadeOut)}},proceedStop:{value:function(a,c){this.log("proceedStop",a),c=c||50,a=a||e.current,this.log("Stopping"),this.events.cancel(),this.softLoops.cancel(),this.clearAll(a,c),b.remove(this.type,this.instanceId)}},volume:{get:function(){return this.output.gain},set:function(a){this._volume=a,this.waVolume=c.dbToWAVolume(this._volume),this.output&&(this.output.gain.value=this.waVolume)}}})}),dmaf("loadBin",["assetController","instances","actions","context","assets","core","_","info","async","events"],function(a,b,c,d,e,f,g,h,i,j){function k(a,b,c,e){function f(b){a.dispatchProgress(c.name,100),m(c.name,b),e(null)}function g(){a.dispatchProgress(c.name,100),e("Error decoding binary data: "+c.name)}var h=b.slice(c.start,c.end);d.decodeAudioData(h,f,g)}var l=g.propIs("format",h.audioFormat),m=g.autocurry(e.set)("buffer");b.register("assetController",{id:{value:"loadBin"},assetType:{value:"buffer"},load:{value:function(a){function b(b){b&&(e.error(b),console.log(b)),e.returnEvent&&j.dispatch(e.returnEvent),"preload_assets"===a&&j.dispatch("_internal:preload_complete")}function c(a,c){if(a){for(var h=0;h<d.files.length;h++)e.dispatchProgress(d.files[h].name,100);return b("Could not load binary data due to network error: "+f.assetsPath+d.path),void 0}i.each(d.files,g.curry(k,e,c),b)}var d=this.headers.filter(l).pop(),e=this;g.getArrayBuffer(f.assetsPath+d.path,c)}}}),c.register("assetController","loadBin",c.get(["assetController","load"]))}),dmaf("loadHTMLAudio",["events","assetController","instances","actions","audioManager","async","info"],function(a,b,c,d,e,f,g){c.register("assetController",{id:{value:"loadHTMLAudio"},load:{value:function(b){var c=this,d="series",h=this.files.map(function(b){return function(d){a.once("_internal:audio:"+b+".READY",function(){c.log("loaded",b),a.remove("_internal:audio:"+b+".ERROR"),d(null)}),a.once("_internal:audio:"+b+".ERROR",function(){a.remove("_internal:audio:"+b+".READY"),d("Could not load "+b)}),c.dispatchProgress(b,100),e.loadElement(b)}});d="Safari"===g.browser?"series":"parallel",f[d](h,function(d){return d?a.dispatch("log:error:instance:assetController",d):(c.returnEvent&&a.dispatch(c.returnEvent),"preload_assets"===b&&a.dispatch("_internal:preload_complete"),void 0)})}}}),d.register("assetController","loadHTMLAudio",d.get(["assetController","load"]))}),dmaf("audioBus",["audioRouter","instances","actions","audioNode","context","_"],function(a,b,c,d,e,f){function g(a,c,d,e){b.vivify(e)}b.register("audioRouter",{id:{value:"audioBus"},construct:{value:function(){this.input=e.createGainNode(),this.output=e.createGainNode()}},init:{value:function(a){var c,g,h=[];d.createRecursive||(d.createRecursive=function(){return[]}),this.effects=d.createRecursive(this.input,a.audioNodes),c=this.effects.length?this.effects.slice(0).pop():this.input,c.connect(this.output),f.each(this.outputs,function(a,c){g=b.get("audioRouter:"+c),g&&(h.push(c),this.output.connect(g.input))},this),h.length||this.output.connect(e.destination)}},volume:{get:function(){return this.output.gain},set:function(a){this.output.gain.value=f.dbToWAVolume(a)}}}),c.register("audioRouter","audioBus",g)}),dmaf("htmlBus",["audioRouter","instances","actions","_","events"],function(a,b,c,d,e){function f(a,c,d,e){b.vivify(e)}b.register("audioRouter",{id:{value:"htmlBus"},volume:{get:function(){return this._volume},set:function(a){this._volume=a,e.dispatch("_internal:audioRouter:"+this.instanceId+":volume")}}}),c.register("audioRouter","htmlBus",f)}),dmaf("transform",["actions","instances"],function(a,b){function c(a,c,d,e){for(var f,g=0,h=e.targets.length;h>g;g++)f=b.get([e.targetType,e.targets[g]]),f&&f.setProperty(e.targetParameter,e.value,e.duration,c)}a.register("control","transform",c)}),dmaf("eventMapper",["eventProcessor","events","actions","instances","_","time"],function(a,b,c,d,e,f){function g(a,b,c,e){d.vivify(e).execute(a,b,c)}var h=e.prop("in");c.register("eventProcessor","eventMapper",g),d.register("eventProcessor",{id:{value:"eventMapper"},init:{value:function(){this.lastEvent="",this.lastExecutedTime=-1,this.pending=f.createScheduler(this,this.send,0)}},send:{value:function(a,c){"ALWAYS"===this.dispatch||a!==this.lastEvent?(this.log("dispatching",a,c),b.dispatch.apply(null,arguments),this.lastEvent=a):this.log("onChange settings prevented dispatching of",a)}},execute:{value:function(a,b,c){return f.current-this.lastExecutedTime<this.reTrig?(this.log("Retrig prevented execution."),void 0):(this.clearPending&&(this.log("Clearing Pending",a),this.pending.cancel()),this.eventMaps.forEach(function(d){var f=h(d).filter(e.is(a)).pop();f&&f!==d.out&&(this.log("Scheduling",b,d.out,b+d.delay),this.pending.schedule(b+d.delay,d.out,b+d.delay,c))},this),this.lastExecutedTime=f.current,void 0)}}})}),dmaf("customAction",["actions","events"],function(a,b){function c(c,d,e,f){var g=a.get(["custom",f.name]);g?g.apply(null,arguments):b.dispatch("log:action:customCode:customAction"+f.name,"Couldn't find "+f.name)}a.register("customCode","customAction",c)}),dmaf("mediaController",["events","time","actions","_"],function(a,b,c,d){function e(a,b,c){var e=a.split(d.dot),h=e.pop(),i=e.pop();switch(h){case"CREATE":g[i]=new f(c);break;case"REMOVE":g[i]&&(g[i].cleanup(),delete g[i]);break;default:dmaf.error("Don't bind "+h+" to the mediaController")}}function f(c){function e(){l=-1/0,m=!1,d.addDOMListener(j,"timeupdate",h)}function f(){l=-1/0,d.removeDOMListener(j,"timeupdate",h),a.dispatch(k+".PAUSED")}function g(){m=!0,d.removeDOMListener(j,"timeupdate",h),a.dispatch(k+".ENDED")}function h(){var c;j.readyState>0&&!m&&(c=b.current-1e3*j.currentTime,Math.abs(c-l)>50&&j.duration-j.currentTime>.5&&(l=c,a.dispatch(k+".PLAYING",l)))}function i(){d.removeDOMListener(j,"play",e),d.removeDOMListener(j,"ended",g),d.removeDOMListener(j,"pause",f),d.removeDOMListener(j,"timeupdate",h)}if(!c||!c.obj)return dmaf.error("mediaController missing media element");var j=c.obj,k=c.id,l=-1/0,m=!1;this.cleanup=i,d.addDOMListener(j,"play",e),d.addDOMListener(j,"pause",f),d.addDOMListener(j,"ended",g),j.readyState>0&&!j.paused&&e()}var g={};c.register("element","mediaController",e)}),dmaf("genericPlay",["sound","instances","actions","time"],function(a,b,c){function d(a,c,d,e){b.vivify(e).play(c)}b.register("sound",{id:{value:"genericPlay"},getSoundFile:{value:function(){return this.soundFile}}}),c.register("sound","genericPlay",d)}),dmaf("htmlPlay",["_","events","time","instances","actions","audioManager"],function(a,b,c,d,e,f){function g(a,b,c,e){d.vivify(e).play(b)}function h(b){b.volume=a.dbToJSVolume(+this)}a.propIs("playing",!1);e.register("sound","htmlPlay",g),d.register("sound",{id:{value:"htmlPlay"},construct:{value:function(){this.sounds=[],this.plays=c.createScheduler(this,this.proceedPlay,0),this.stops=c.createScheduler(this,this.proceedStop,0),this.events=c.createScheduler(b,b.dispatch,0),this.softLoops=c.createScheduler(this,this.proceedPlay,0),this.disposes=c.createScheduler(this,this.dispose,0),this.playing=!1,this.lastExecuted=-1}},init:{value:a.noop},output:{get:function(){return this._output},set:function(a){this._output=d.get("audioRouter:"+a),this._output||(this._output={volume:0}),b.add("_internal:audioRouter:"+a+":volume",function(){this.volume=this.volume}.bind(this))}},checkFinished:{value:function(){this.sounds=this.sounds.filter(function(a){return a.active=a.playing,a.active}),this.playing=!!this.sounds.length}},clearAll:{value:function(){for(var a=this.sounds.shift();a;)a.pause(),a.active=!1,a=this.sounds.shift();this.log("Cleared all sounds"),this.playing=!1}},dispose:{value:function(a){var b=this.sounds.indexOf(a);b>-1&&(a=this.sounds.splice(b,1).pop(),a.active=!1),this.playing=!!this.sounds.length}},proceedPlay:{value:function(a,d){if(this._wait&&(this._wait.targetSound.active=!1,b.remove("_internal:audio:"+this.soundFile+".READY",this._wait)),d=d||f.requestElement(this.soundFile,this),null!==d){if(!d.loaded)return this._wait=b.once("_internal:audio:"+this.soundFile+".READY",function(){this._wait=null,this.proceedPlay(a,d)}.bind(this)),this._wait.targetSound=d,void 0;h.call(this.volume+this.output.volume,d);var e,g,i=1e3*d.duration;if("PLAY"===this.timingCorrection)a=c.current,e=0;else{if("RESYNC"===this.timingCorrection&&this.clearAll(),c.current>a+i)return;e=.001*(c.current-a),e=0>e?0:e}d.currentTime=e,d.play(),this.events.cancel(),this.returnEvent&&(g=a+i+this.returnEventTime,this.events.schedule(g,this.returnEvent,g)),-1===this.loop?this.disposes.schedule(a+i,d):0===this.loop?(this.disposes.schedule(a+i,d),this.softLoops.schedule(a+i,a+i)):(this.disposes.schedule(a+i,d),this.softLoops.schedule(a+this.loop,a+this.loop)),(this.loop>-1||this.reTrig>-1)&&f.prepareDuplicate(this.soundFile),this.playing=!0,this.sounds.push(d)}}},volume:{get:function(){return this._dbVolume},set:function(b){var c=b;this.output&&(c+=this.output.volume||0),c=a.dbToJSVolume(c),this._dbVolume=b;for(var d=0,e=this.sounds.length;e>d;d++)this.sounds[d].volume=c}}})}),dmaf("stepPlay",["sound","instances","actions","_"],function(a,b,c,d){function e(a,c,d,e){b.vivify(e).play(c)}b.register("sound",{id:{value:"stepPlay"},getSoundFile:{value:function(){return this.iterator||(this.iterator=d.iterator(this.soundFiles,this.generator)),this.iterator.getNext()}}}),c.register("sound","stepPlay",e)}),dmaf("soundStop",["instances","actions"],function(a,b){function c(b,c,d,e){e.targets.forEach(function(b){b=a.get(["sound",b]),b&&b.stop(c)})}b.register("sound","soundStop",c)}),dmaf("main_controller",["actions","DMAF","Instance","Utils","events"],function(a,b,c,d,e){function f(a,b){switch(a){case"load_english":this.useVoice=!0;break;case"load_other":this.useVoice=!1;break;case"outroVideo.PLAYING":case"sceneOneIntro.PLAYING":case"sceneOneTransition.PLAYING":case"sceneTwoIntro.PLAYING":case"sceneTwoTransition.PLAYING":case"sceneThreeTransition.PLAYING":case"sceneThreeIntro.PLAYING":this.useVoice===!0?e.dispatch("voice_"+a,b):e.dispatch("no_voice_"+a,b);break;case"outroVideo.PAUSED":case"sceneOneIntro.PAUSED":case"sceneOneTransition.PAUSED":case"sceneTwoIntro.PAUSED":case"sceneTwoTransition.PAUSED":case"sceneThreeIntro.PAUSED":case"sceneThreeTransition.PAUSED":this.useVoice===!0?e.dispatch("voice_"+a,b):e.dispatch("no_voice_"+a,b);break;case"showSceneOneDescisionPoint":case"sceneOneFailPage":case"showSceneTwoDescisionPoint":case"sceneTwoFailPage":case"showSceneThreeDescisionPoint":case"sceneThreeFailPage":this.useVoice===!0&&e.dispatch(a+"_x")}}this.useVoice=!0,a.register("custom","main_controller",f)}),dmaf._init(function(a){function b(b){return A.ok?(v(),window.core=a,a.projectPath=a.projectPath||b||"./",console.log("dmaf loading from",a.projectPath),z.waterfall(C,n)):u({type:"compatibility"}),dmaf}function c(c,d){return A.ok&&"string"==typeof c?d||dmaf.dev?(dmaf.dev=!0,b(c)):("/"!==c[c.length-1]&&(c+="/"),a.assetsPath=c,z.series(D,n)):u({type:"compatibility"}),dmaf}function d(b){B.getJSON(a.projectPath+"project.json",function(c,d){var e,f;return c?b("Problem loading project.json"):(a.localFramework&&(e=a.localFramework),a.localAssets&&(f=a.localAssets),B.extend(d,a),a.localFramework=e||a.localFramework,a.localAssets=f||a.localAssets,dmaf.dev&&m(),a.assetsPath=a.assetsPath||a.projectPath+"assets/",a.useLocal&&(a.assetsPath=a.localAssets,a.framework=a.localFramework),b(null),void 0)})}function e(b){B.getJSON(a.assetsPath+"json/dmaf_data.json",function(c,d){return c?b({type:"loading"}):(B.extend(d,a),b(null),void 0)})}function f(b){var c=a.scripts.map(r);a.configs=a.configs.map(q),B.getJSON(a.framework+"src/js/framework/index.json",function(d,e){return d?b("Problem getting index.json"):(b(null,e.map(B.adder(a.framework)).concat(c)),void 0)})}function g(a,b){z.each(a,B.getScript,function(a){return a?b("Problem getting framework modules."):(b(null),void 0)})}function h(b){B.getDocument(a.framework+"src/xml/descriptors.xml",function(a,c){return a?(console.error("Could not get descriptors"),b("Could not get descriptors")):(b(null,c),void 0)})}function i(b,c){a.descriptors=y.xml(b),z.map(a.configs,B.getDocument,function(b,d){if(b||!d)return c("Could not get configuration files.");try{var e=B.compose(B.prop("children"),s,B.prop("0"),y.xml);a.configs=d.map(e).reduce(B.concatAll)}catch(f){return c("Could not parse configs!")}c(null,a)})}function j(a,b){a.descriptors=y.descriptors(a.descriptors),a.actions=y.actions(a.configs),b(null)}function k(b){var c=a.actions.filter(o);c.map(B.prop("type")).filter(B.uniq).forEach(a.require),c.map(B.prop("id")).filter(B.uniq).forEach(a.require),a.scripts.forEach(a.require),a.actions=c.filter(p),c.forEach(a.require("actions").add),delete a.configs,b(null)}function l(a){var b,c=x.listeners("preload_assets").length,d=B.curry(a,{type:"compatibility"}),e=0;c?(b=setTimeout(d,3e4),x.add("_internal:preload_complete",function(){clearTimeout(b),++e===c?a(null):b=setTimeout(d,3e4)}),x.dispatch("preload_assets")):a(null)}function m(){function b(){var b=B.slice(arguments),c=c||a.require("time")||{current:0},d=b.shift();d=d.split(B.colon).pop(),b.unshift(~~c.current+" "+d+" //"),"Explorer"===A.browser&&A.browserVersion<10?console.log(b.join(" ")):console.log.apply(console,b)}function c(){var b=B.slice(arguments),c=c||a.require("time")||{current:0},d=b.shift();b.unshift(~~c.current+" "+d+" //"),"Explorer"===A.browser&&A.browserVersion<10?console.error(b.join(" ")):console.error.apply(console,b)}dmaf.log=function(){var a=B.slice(arguments);a.unshift("log:info"),b.apply(null,a)},dmaf.error=function(){var a=B.slice(arguments);a.unshift("log:error"),c.apply(null,a)},dmaf.makeLog=function(a){return B.curry(b,"log:info:"+a)},a.logs.forEach(function(a){/\!/.test(a)?x.add(a,b):x.add("log:"+a,b)}),x.add("log:info",b),x.add("log:error",b)
}function n(a){return a?u({type:"loading"}):(E.forEach(x.dispatch),dmaf.dev&&console.log("dmaf is now ready"),void 0)}function o(b){var c;switch(b.requires){case null:c=!0;break;case"webAudio":c=("WEB_AUDIO"===a.audioMode||"FALLBACK"===a.audioMode)&&A.webaudio;break;case"htmlAudio":c="HTML_AUDIO"===a.audioMode||"FALLBACK"===a.audioMode&&!A.webaudio}return c?(B.each(A,function(a){if(b[a]){var d=B.bang.test(b[a]);b[a]=B.bool(b[a]),c=d?A[a]!==b[a].replace(B.bang,B.E):A[a]===b[a]}}),c):c}function p(b){var c=!0;return void 0===B.get(a.descriptors.action,[b.type,b.id])&&(dmaf.dev&&console.log("Was not in descriptors",b.type,b.id),c=!1),a.seen[b.id]||(dmaf.dev&&console.log("Module not seen",b.type,b.id),c=!1),c||dmaf.dev&&console.error("Invalid action: "+b.type+" "+b.id),c}function q(b){return a.projectPath+"config/"+b+".xml"}function r(b){return a.projectPath+"scripts/"+b+".js"}function s(a){return a.attrs&&a.attrs.length&&a.children.forEach(function(b){b.attrs=b.attrs.concat(a.attrs)}),a}function t(a){var b={name:a,pending:[]};return dmaf[a]=function(){return b.pending.push(arguments),dmaf},b}function u(b){var c=a.pending.filter(B.propIs("name","fail")).pop();if(c&&c.pending.length)for(var d=0;d<c.pending.length;d++)c.pending[d][0]&&"function"==typeof c.pending[d][0]&&c.pending[d][0](b)}function v(){console.log("DMAF v"+dmaf.version+" Running in "+A.OS+" "+A.browser+" "+A.browserVersion)}var w=["addEventListener","once","ready","fail","registerObject","unregisterObject","removeEventListener","tell"],x=a.require("events"),y=a.require("parse"),z=a.require("async"),A=a.require("info"),B=(a.require("ajax"),a.require("_")),C=[d,f,g,h,i,j,k,l],D=[e,k,l],E=["_internal:resolve_listeners","init_routing","_internal:resolve_input","dmaf_ready"];if(dmaf.log=dmaf.error=B.noop,dmaf.ok=function(b){return A.ok=b(a),dmaf},A.web){var F=B.decodeQuery(window.location.href);F&&F.dmaf&&(a.projectPath=F.dmaf,dmaf.dev=!0,console.log("Found dmaf",a.projectPath))}a.pending=w.map(t),delete dmaf._init,dmaf.init=dmaf.dev?b:c}.bind(this));